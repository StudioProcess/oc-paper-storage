<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>oc-paper-storage</title>
  <link rel="stylesheet" href="main.css">
  <style>
    canvas {
      width: auto !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <!-- <script src="node_modules/three/build/three.js"></script>
  <script src="node_modules/three/examples/js/controls/OrbitControls.js"></script> -->
  
  <script type="module">
    import * as lib from './lib.js';
    
    let files = [
      'data/ocr/Chun_Code_as_Fetish-OCR.txt',
      'data/ocr/Kalkuele_als_Repraesentationen-OCR.txt',
      'data/ocr/Kittler_Friedrich_2008_Code_or_How_You_Can_Write_Something_Differently-OCR.txt',
      'data/ocr/Knuth_Babylonian_Algorithms-OCR.txt'
    ];
    
    let current = 0;
    let sort = false;
    let img;
    loadIndex( current, sort );
    
    document.addEventListener("keyup", (e) => {
      if (e.keyCode == 39) { loadIndex(current+1, sort); }
      else if (e.keyCode == 37) { loadIndex(current-1, sort); }
      else if (e.key == ' ') { loadIndex(current, !sort); }
      else if (e.key == 's') {
        let svgtext = lib.img2svg(img);
        lib.saveSVG(svgtext, 'download.svg');
      }
    });
    
    function loadIndex( idx, _sort = false ) {
      if (idx < 0) idx = 0;
      else if (idx >= files.length) idx = files.length-1;
      current = idx;
      sort = _sort;
      loadFile( files[current], sort );
    }
    
    function loadFile( file, sort = false ) {
      return fetch(file)
      .then(res => res.arrayBuffer())
      .then(buf => {
        img = lib.encode(buf, {sort}); // ImageData
        var canvas = document.querySelector('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        let ctx = canvas.getContext('2d');
        ctx.putImageData(img, 0, 0);
      });
    }
  </script>
  
  <canvas style="image-rendering:pixelated;"></canvas>
</body>
</html>
